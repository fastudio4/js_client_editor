<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/add.css">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/fabric.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <title>Print to coffee</title>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <canvas id="base-layout" style="border-radius: 50%; border:1px solid #6f4e37;"></canvas>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4><strong>Добавить изображение</strong></h4>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="btn btn-primary btn-file" id="add-image">
                                Добавить <input id="load-image" type="file" name="file">
                            </label>
                                <strong><span class="text-danger" id="error-loading-file"></span></strong>
                        </div>
                        <div id="remote-image" style="display: none">
                            <div>
                                <button id="delete-image" class="btn btn-danger" type="button" onclick="removeImage()">Удалить</button>
                                <span id="name-file"></span>
                            </div>

                            <p><b>Редактировать</b></p>
                            <div>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Приблизить"><span class="glyphicon glyphicon-zoom-in editor" aria-hidden="true"></span></button>
                                    <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Отдалить"><span class="glyphicon glyphicon-zoom-out editor" aria-hidden="true"></span></button>
                                    <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Повернуть"><span class="glyphicon glyphicon-repeat editor" aria-hidden="true"></span></button>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="glyphicon glyphicon-tint editor"></span> Градиент
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a href="#">Dropdown link</a></li>
                                            <li><a href="#">Dropdown link</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4><strong>Добавить теск</strong></h4>
                    </div>
                    <div class="panel-body">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-default" data-toggle="tooltip" data-placement="top" title="Приблизить"><span class="glyphicon glyphicon-zoom-in editor" aria-hidden="true"></span></button>
                        </div>
                        <p></p>
                        <div class="form-group">
                            <textarea class="form-control" rows="3" id="text-input"></textarea>
                        </div>
                        <button id="add-text" class="btn btn-primary" type="button" onclick="addText()">Добавить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>

        var canvas = new fabric.Canvas('base-layout');
            canvas.setHeight(500);
            canvas.setWidth(500);
        var image;
            document.getElementById('load-image').onchange = function handleImage(e) {
                var nameImage = document.getElementById('load-image').files[0].name;
                if (securityFormat(nameImage.toLowerCase()) == true) {
                    document.getElementById('error-loading-file').innerHTML = '';
                    document.getElementById('add-image').style = '';
                    document.getElementById('add-image').style.display = 'none';
                    document.getElementById('remote-image').style.display = '';
                    document.getElementById('name-file').innerHTML = nameImage;
                    var reader = new FileReader();
                    reader.onload = function (event) {
                        var imgObj = new Image();
                        imgObj.src = event.target.result;
                        imgObj.onload = function () {
                            image = new fabric.Image(imgObj);
                            canvas.add(image);
                        };
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            };

        function securityFormat(name) {
            var acceptFormat = 'jpg jpeg png';
            var nameFile = name.split('/').pop();
            var formatFile = name.split('.').pop();
            if (nameFile != formatFile) {
                if (acceptFormat.indexOf(formatFile) >= 0) {
                    return true;
                }
                else {
                    document.getElementById('error-loading-file').innerHTML = 'Недопустимый формат файла!';
                    return false;
                }
            }
            else {
                document.getElementById('error-loading-file').innerHTML = 'Ошибка чтения файла!';
                return false;
            }
        }

        function removeImage(){
            canvas.remove(image);
            document.getElementById('add-image').style.display = '';
            document.getElementById('remote-image').style.display = 'none';
            document.getElementById('name-file').innerHTML = ''
        }

        function addText() {
            var inputText = document.getElementById('text-input').value;
            var text = new fabric.Text(inputText);
                text.left = canvas.width / 2 - text.width / 2;
                text.top = canvas.height / 2 - text.height / 2;
//            console.log(text);
            canvas.add(text);
        }
    </script>

</body>
</html>